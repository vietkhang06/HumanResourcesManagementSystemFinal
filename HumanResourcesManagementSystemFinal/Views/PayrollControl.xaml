<UserControl x:Class="HumanResourcesManagementSystemFinal.Views.PayrollControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:HumanResourcesManagementSystemFinal.ViewModels"
             xmlns:cnv="clr-namespace:HumanResourcesManagementSystemFinal.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000" Background="Transparent">

    <UserControl.DataContext>
        <vm:PayrollViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <cnv:NameToInitialsConverter x:Key="NameToInitialsConverter"/>
        <Geometry x:Key="IconMoney">M96 0C60.7 0 32 28.7 32 64s28.7 64 64 64l48 0 0 32-57 0c-31.6 0-58.5 23.1-63.3 54.4L1.1 364.1C.4 368.8 0 373.6 0 378.4L0 448c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-69.6c0-4.8-.4-9.6-1.1-14.4L488.2 214.4C483.5 183.1 456.6 160 425 160l-217 0 0-32 48 0c35.3 0 64-28.7 64-64S291.3 0 256 0L96 0zm0 48l160 0c8.8 0 16 7.2 16 16s-7.2 16-16 16L96 80c-8.8 0-16-7.2-16-16s7.2-16 16-16zM64 424c0-13.3 10.7-24 24-24l336 0c13.3 0 24 10.7 24 24s-10.7 24-24 24L88 448c-13.3 0-24-10.7-24-24zm48-160a24 24 0 1 1 0-48 24 24 0 1 1 0 48zm120-24a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM160 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48zM328 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM256 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48zM424 240a24 24 0 1 1 -48 0 24 24 0 1 1 48 0zM352 344a24 24 0 1 1 0-48 24 24 0 1 1 0 48z</Geometry>
        <Geometry x:Key="IconCalculator">M13 9H21L11 24V15H4L13 0V9ZM11 11V7.22063L7.53238 13H13V17.3944L17.263 11H11Z</Geometry>
        <Geometry x:Key="IconUsers">M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z</Geometry>
        <Geometry x:Key="IconInfo">M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z</Geometry>
        <Geometry x:Key="IconCalendar">M17 3H21C21.5523 3 22 3.44772 22 4V20C22 20.5523 21.5523 21 21 21H3C2.44772 21 2 20.5523 2 20V4C2 3.44772 2.44772 3 3 3H7V1H9V3H15V1H17V3ZM4 9V19H20V9H4ZM6 11H8V13H6V11ZM11 11H13V13H11V11ZM16 11H18V13H16V11Z</Geometry>
        <Geometry x:Key="IconWallet">M21 18v1c0 1.1-.9 2-2 2H5c-1.11 0-2-.9-2-2V5c0-1.1.89-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.11 0-2 .9-2 2v8c0 1.1.89 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z</Geometry>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#718096"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,0,15,15"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
        </Style>
        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#F7FAFC"/>
            <Setter Property="Height" Value="55"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F7FAFC"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="15,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Padding="{TemplateBinding Padding}" Background="Transparent">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel VerticalAlignment="Center">
                <StackPanel Orientation="Horizontal">
                    <Path Data="{StaticResource IconMoney}" Fill="#1A3D64" Height="24" Width="24" Stretch="Uniform" Margin="0,0,10,0"/>
                    <TextBlock Text="Bảng Tính Lương" FontSize="24" FontWeight="Bold" Foreground="#1A3D64"/>
                </StackPanel>
                <TextBlock Text="Tự động tính toán dựa trên hợp đồng và chấm công" 
                           FontSize="13" Foreground="#718096" Margin="34,5,0,0"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <Border Background="White" CornerRadius="8" Margin="0,0,15,0" Padding="5">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" Opacity="0.05" Color="#000"/>
                    </Border.Effect>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Background="#F7FAFC" CornerRadius="6" Padding="8" Margin="0,0,10,0">
                            <Path Data="{StaticResource IconCalendar}" Fill="#4A5568" Width="16" Height="16" Stretch="Uniform"/>
                        </Border>

                        <TextBlock Text="Tháng" VerticalAlignment="Center" Foreground="#718096" Margin="0,0,5,0"/>
                        <ComboBox ItemsSource="{Binding Months}" SelectedItem="{Binding SelectedMonth}" 
                                  Width="60" FontWeight="SemiBold" BorderThickness="0" Background="Transparent" VerticalContentAlignment="Center"/>

                        <TextBlock Text="/" VerticalAlignment="Center" Foreground="#CBD5E0" Margin="5,0"/>

                        <ComboBox ItemsSource="{Binding Years}" SelectedItem="{Binding SelectedYear}" 
                                  Width="80" FontWeight="SemiBold" BorderThickness="0" Background="Transparent" VerticalContentAlignment="Center"/>
                    </StackPanel>
                </Border>

                <Button Command="{Binding CalculatePayrollCommand}"
                        Background="#1A3D64" Foreground="White" Height="45" Padding="20,0" BorderThickness="0" Cursor="Hand">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="8"/>
                        </Style>
                    </Button.Resources>
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource IconCalculator}" Fill="White" Width="16" Height="16" Stretch="Uniform" Margin="0,0,10,0"/>
                        <TextBlock Text="TÍNH LƯƠNG" FontWeight="Bold"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1" Margin="0,0,0,25">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="White" CornerRadius="12" Margin="0,0,20,0">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="15" Opacity="0.08" ShadowDepth="4" Color="#000"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Margin="20">
                        <TextBlock Text="Tổng Thực Lĩnh Dự Kiến" Foreground="#718096" FontSize="13" FontWeight="SemiBold"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="{Binding TotalSalaryFund, StringFormat={}{0:N0}}" 
                                       FontSize="26" FontWeight="Bold" Foreground="#2F855A"/>
                            <TextBlock Text=" VNĐ" VerticalAlignment="Bottom" Margin="4,0,0,5" Foreground="#2F855A" FontWeight="SemiBold" FontSize="12"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Border>

            <Border Grid.Column="1" Background="White" CornerRadius="12" Margin="0,0,20,0">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="15" Opacity="0.08" ShadowDepth="4" Color="#000"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Margin="20">
                        <TextBlock Text="Nhân Sự Đã Tính" Foreground="#718096" FontSize="13" FontWeight="SemiBold"/>
                        <TextBlock Text="{Binding PayrollList.Count, StringFormat={}{0} người}" 
                                   FontSize="26" FontWeight="Bold" Foreground="#2B6CB0" Margin="0,8,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Border Grid.Column="2" Background="#F0F4F8" CornerRadius="12" Padding="20">
                <StackPanel VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <Path Data="{StaticResource IconInfo}" Fill="#2C5282" Width="16" Height="16" Stretch="Uniform" Margin="0,0,8,0"/>
                        <TextBlock Text="Lưu ý hệ thống" FontWeight="Bold" Foreground="#2C5282"/>
                    </StackPanel>
                    <TextBlock Text="Hệ thống sẽ tự động tổng hợp số ngày công từ bảng chấm công và mức lương từ hợp đồng mới nhất." 
                               TextWrapping="Wrap" Foreground="#4A5568" FontSize="12" LineHeight="18"/>
                </StackPanel>
            </Border>
        </Grid>

        <Border Grid.Row="2" Background="White" CornerRadius="12" Padding="0,10,0,0">
            <Border.Effect>
                <DropShadowEffect BlurRadius="15" Opacity="0.08" ShadowDepth="2" Color="#000"/>
            </Border.Effect>

            <DataGrid ItemsSource="{Binding PayrollList}" 
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False" 
                      IsReadOnly="True" 
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="#F0F0F0"
                      Background="White" 
                      BorderThickness="0" 
                      HeadersVisibility="Column">

                <DataGrid.Columns>
                    <DataGridTextColumn Header="MÃ NV" Binding="{Binding EmployeeId}" Width="80" Foreground="#A0AEC0">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                        <DataGridTextColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.HeaderStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="HỌ VÀ TÊN" Width="2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Border Width="30" Height="30" CornerRadius="15" Background="#E2E8F0" Margin="0,0,10,0">
                                        <TextBlock Text="{Binding FullName, Converter={StaticResource NameToInitialsConverter}}" 
                                                   HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                   FontSize="10" FontWeight="Bold" Foreground="#4A5568"/>
                                    </Border>
                                    <TextBlock Text="{Binding FullName}" FontWeight="Bold" Foreground="#2D3748" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="PHÒNG BAN" Binding="{Binding DepartmentName}" Width="1.5*" Foreground="#718096"/>

                    <DataGridTextColumn Header="LƯƠNG HĐ" Binding="{Binding ContractSalary, StringFormat={}{0:N0}}" Width="140" FontWeight="SemiBold" Foreground="#4A5568">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="Padding" Value="0,0,20,0"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                        <DataGridTextColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                <Setter Property="HorizontalContentAlignment" Value="Right"/>
                                <Setter Property="Padding" Value="0,0,20,15"/>
                            </Style>
                        </DataGridTextColumn.HeaderStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="NGÀY CÔNG" Width="130">
                        <DataGridTemplateColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </DataGridTemplateColumn.HeaderStyle>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="#EDF2F7" CornerRadius="6" Padding="12,4" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding ActualWorkDays}" FontWeight="Bold" Foreground="#2D3748"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="THỰC LĨNH" Width="1.5*">
                        <DataGridTemplateColumn.HeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
                                <Setter Property="HorizontalContentAlignment" Value="Right"/>
                                <Setter Property="Padding" Value="0,0,30,15"/>
                            </Style>
                        </DataGridTemplateColumn.HeaderStyle>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding NetSalary, StringFormat={}{0:N0} đ}" 
                                           FontWeight="Bold" Foreground="#2F855A" FontSize="14" 
                                           HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,30,0"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>