<UserControl x:Class="HumanResourcesManagementSystemFinal.Views.ProfileControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:HumanResourcesManagementSystemFinal.ViewModels"
             xmlns:converters="clr-namespace:HumanResourcesManagementSystemFinal.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="800" Background="Transparent">

    <UserControl.DataContext>
        <vm:MyProfileViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBool"/>
        <converters:BooleanToTextConverter x:Key="BoolToText"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <Geometry x:Key="IconEmail">M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z</Geometry>
        <Geometry x:Key="IconPhone">M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 1.25 0 2.45.2 3.57.57.35.13.75.03 1.02-.24l2.2-2.2z</Geometry>
        <Geometry x:Key="IconLocation">M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z</Geometry>
        <Geometry x:Key="IconWork">M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z</Geometry>
        <Geometry x:Key="IconEdit">M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z</Geometry>
        <Geometry x:Key="IconSave">M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z</Geometry>
        <Geometry x:Key="IconCamera">M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm6 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z</Geometry>

        <Style TargetType="TextBox">
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsReadOnly" Value="True">
                    <Setter Property="Background" Value="#F7FAFC"/>
                    <Setter Property="Foreground" Value="#718096"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="Cursor" Value="Arrow"/>
                </Trigger>
                <Trigger Property="IsReadOnly" Value="False">
                    <Setter Property="BorderBrush" Value="#CBD5E0"/>
                    <Setter Property="Foreground" Value="#2D3748"/>
                </Trigger>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#3182CE"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="TextBlock" x:Key="LabelStyle">
            <Setter Property="Foreground" Value="#718096"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" MinWidth="250"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="White" CornerRadius="15" Margin="0,0,20,0" VerticalAlignment="Top" MaxHeight="800">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" Opacity="0.08" ShadowDepth="5" Color="#000"/>
            </Border.Effect>

            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Height="660">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" CornerRadius="15,15,0,0" Margin="0,0,0,70" Grid.RowSpan="2">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#2C5282" Offset="0"/>
                                <GradientStop Color="#4299E1" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                    </Border>

                    <Grid Grid.Row="0" Grid.RowSpan="2" Margin="0,70,0,0" HorizontalAlignment="Center">
                        <Ellipse Width="140" Height="140" Stroke="White" StrokeThickness="5">
                            <Ellipse.Effect>
                                <DropShadowEffect BlurRadius="10" Opacity="0.15"/>
                            </Ellipse.Effect>
                            <Ellipse.Fill>
                                <ImageBrush ImageSource="{Binding AvatarImage}" Stretch="UniformToFill"/>
                            </Ellipse.Fill>
                        </Ellipse>

                        <Button Command="{Binding ChangeAvatarCommand}" 
                                Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                                Width="36" Height="36" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,5,5"
                                Background="White" BorderBrush="#CBD5E0" BorderThickness="1" Cursor="Hand">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="18"/>
                                </Style>
                            </Button.Resources>
                            <Path Data="{StaticResource IconCamera}" Fill="#4A5568" Width="18" Height="18" Stretch="Uniform"/>
                        </Button>
                    </Grid>

                    <StackPanel Grid.Row="2" Margin="30,10,30,30">
                        <TextBlock Text="{Binding CurrentUser.FullName}" 
                                   FontSize="24" FontWeight="Bold" Foreground="#2D3748" 
                                   HorizontalAlignment="Center" TextAlignment="Center" TextWrapping="Wrap"/>

                        <TextBlock Text="{Binding CurrentUser.Position.Title}" 
                                   FontSize="14" Foreground="#718096" FontWeight="SemiBold"
                                   HorizontalAlignment="Center" Margin="0,5,0,0"/>

                        <Border Background="#EBF8FF" CornerRadius="15" Padding="15,6" 
                                HorizontalAlignment="Center" Margin="0,-20,0,25">
                            <TextBlock Text="{Binding AccountRole}" Foreground="#3182CE" FontWeight="Bold" FontSize="12"/>
                        </Border>

                        <Separator Background="#EDF2F7" Margin="0,-10,0,10"/>

                        <StackPanel Margin="0,0,0,20">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <Path Data="{StaticResource IconEmail}" Fill="#A0AEC0" Width="18" Height="18" Stretch="Uniform" Margin="0,0,15,0"/>
                                <TextBlock Text="{Binding CurrentUser.Email}" VerticalAlignment="Center" Foreground="#4A5568" TextTrimming="CharacterEllipsis" MaxWidth="250"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                                <Path Data="{StaticResource IconPhone}" Fill="#A0AEC0" Width="18" Height="18" Stretch="Uniform" Margin="0,0,15,0"/>
                                <TextBlock Text="{Binding CurrentUser.PhoneNumber}" VerticalAlignment="Center" Foreground="#4A5568"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource IconWork}" Fill="#A0AEC0" Width="18" Height="18" Stretch="Uniform" Margin="0,0,15,0"/>
                                <TextBlock Text="{Binding CurrentUser.Department.DepartmentName}" VerticalAlignment="Center" Foreground="#4A5568" TextWrapping="Wrap" MaxWidth="250"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Border>

        <Border Grid.Column="1" Background="White" CornerRadius="15">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" Opacity="0.08" ShadowDepth="5" Color="#000"/>
            </Border.Effect>

            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Padding="0,0,5,0">
                <StackPanel Margin="40">

                    <Grid Margin="0,0,0,30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel VerticalAlignment="Center" Margin="0,0,10,0">
                            <TextBlock Text="Hồ Sơ Chi Tiết" FontSize="22" FontWeight="Bold" Foreground="#1A3D64"/>
                        </StackPanel>

                        <Button Grid.Column="1" Command="{Binding ToggleEditCommand}" 
                                Background="{Binding IsEditing, Converter={StaticResource BoolToText}, ConverterParameter='#48BB78|#3182CE'}" 
                                Foreground="White" BorderThickness="0" Padding="15,10" Cursor="Hand" VerticalAlignment="Top">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </Button.Resources>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding IsEditing, Converter={StaticResource BoolToText}, ConverterParameter='LƯU|SỬA'}" FontWeight="Bold"/>
                            </StackPanel>
                        </Button>
                    </Grid>

                    <TextBlock Text="THÔNG TIN CÁ NHÂN" FontSize="14" FontWeight="Bold" Foreground="#2D3748" Margin="0,0,0,20"/>

                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Họ &amp; Tên Đệm" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.LastName, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Tên" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.FirstName, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}"/>
                        </StackPanel>
                    </Grid>

                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Email" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.Email, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Số Điện Thoại" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.PhoneNumber, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}"/>
                        </StackPanel>
                    </Grid>

                    <StackPanel Margin="0,0,0,30">
                        <TextBlock Text="Địa Chỉ Thường Trú" Style="{StaticResource LabelStyle}"/>
                        <TextBox Text="{Binding CurrentUser.Address, UpdateSourceTrigger=PropertyChanged}" 
                                 IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}" 
                                 Height="80" TextWrapping="Wrap" VerticalContentAlignment="Top"/>
                    </StackPanel>

                    <Separator Background="#EDF2F7" Margin="0,0,0,30"/>

                    <TextBlock Text="THÔNG TIN CÔNG VIỆC" FontSize="14" FontWeight="Bold" Foreground="#2D3748" Margin="0,0,0,20"/>

                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*" MinWidth="150"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Mã Nhân Viên" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.Id}" IsReadOnly="True" Background="#F7FAFC" Foreground="#A0AEC0" BorderBrush="Transparent"/>
                        </StackPanel>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Ngày Vào Làm" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.HireDate, StringFormat='dd/MM/yyyy'}" IsReadOnly="True" Background="#F7FAFC" Foreground="#A0AEC0" BorderBrush="Transparent"/>
                        </StackPanel>
                    </Grid>

                    <StackPanel Margin="0,0,0,50">
                        <TextBlock Text="Phòng Ban Trực Thuộc" Style="{StaticResource LabelStyle}"/>
                        <TextBox Text="{Binding CurrentUser.Department.DepartmentName}" IsReadOnly="True" Background="#F7FAFC" Foreground="#A0AEC0" BorderBrush="Transparent"/>
                    </StackPanel>

                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>