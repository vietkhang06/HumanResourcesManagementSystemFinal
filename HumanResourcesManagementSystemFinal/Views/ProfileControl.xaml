<UserControl x:Class="HumanResourcesManagementSystemFinal.Views.ProfileControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:vm="clr-namespace:HumanResourcesManagementSystemFinal.ViewModels"
             xmlns:converters="clr-namespace:HumanResourcesManagementSystemFinal.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="750" d:DesignWidth="900" Background="Transparent"
             Loaded="UserControl_Loaded">

    <UserControl.DataContext>
        <vm:ProfileViewModel/>
    </UserControl.DataContext>

    <UserControl.Resources>
        <converters:InverseBooleanConverter x:Key="InverseBool"/>
        <converters:BooleanToTextConverter x:Key="BoolToText"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <converters:BinaryImageConverter x:Key="BinaryImageConverter"/>

        <Geometry x:Key="IconEmail">M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z</Geometry>
        <Geometry x:Key="IconPhone">M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 1.25 0 2.45.2 3.57.57.35.13.75.03 1.02-.24l2.2-2.2z</Geometry>
        <Geometry x:Key="IconWork">M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z</Geometry>
        <Geometry x:Key="IconCamera">M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm6 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z</Geometry>
        <Geometry x:Key="IconEdit">M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z</Geometry>
        <Geometry x:Key="IconSave">M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z</Geometry>

        <Style TargetType="TextBox">
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="6">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsReadOnly" Value="True">
                    <Setter Property="Background" Value="#F8FAFC"/>
                    <Setter Property="Foreground" Value="#64748B"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                </Trigger>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#3B82F6"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="TextBlock" x:Key="LabelStyle">
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="White" CornerRadius="15" Margin="0,0,20,0" VerticalAlignment="Center" Height="710">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" Opacity="0.05" ShadowDepth="5" Color="#000"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" CornerRadius="15,15,0,0" Height="126" VerticalAlignment="Top">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#1E3A8A" Offset="0"/>
                            <GradientStop Color="#1E3A8A" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <Grid Grid.Row="0" Margin="0,40,0,0" HorizontalAlignment="Center">
                    <Ellipse Width="120" Height="120" Stroke="White" StrokeThickness="4" Margin="0,28,0,-28">
                        <Ellipse.Effect>
                            <DropShadowEffect BlurRadius="10" Opacity="0.1"/>
                        </Ellipse.Effect>
                        <Ellipse.Fill>
                            <ImageBrush ImageSource="{Binding CurrentUser.Account.AvatarData, Converter={StaticResource BinaryImageConverter}}" Stretch="UniformToFill"/>
                        </Ellipse.Fill>
                    </Ellipse>

                    <Button Command="{Binding ChangeAvatarCommand}" 
                            Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}"
                            Width="32" Height="32" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,5,5"
                            Background="White" BorderBrush="#E2E8F0" BorderThickness="1" Cursor="Hand">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="16"/>
                            </Style>
                        </Button.Resources>
                        <Path Data="{StaticResource IconCamera}" Fill="#475569" Width="16" Height="16" Stretch="Uniform"/>
                    </Button>
                </Grid>

                <StackPanel Grid.Row="1" Margin="20,40,20,30">
                    <TextBlock Text="{Binding CurrentUser.FullName}" FontSize="20" FontWeight="Bold" Foreground="#1E293B" HorizontalAlignment="Center" TextAlignment="Center" TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding CurrentUser.Position.PositionName}" FontSize="14" Foreground="#64748B" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,5,0,15"/>
                    <Border Background="#EFF6FF" CornerRadius="12" Padding="15,5" HorizontalAlignment="Center" BorderBrush="#DBEAFE" BorderThickness="1">
                        <TextBlock Text="{Binding AccountRole}" Foreground="#2563EB" FontWeight="Bold" FontSize="12"/>
                    </Border>
                </StackPanel>

                <StackPanel Grid.Row="2" Margin="30,0,30,40">
                    <Separator Background="#F1F5F9" Margin="0,0,0,20"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,25">
                        <Path Data="{StaticResource IconEmail}" Fill="#94A3B8" Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                        <TextBlock Text="{Binding CurrentUser.Email}" VerticalAlignment="Center" Foreground="#475569" TextTrimming="CharacterEllipsis"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,25">
                        <Path Data="{StaticResource IconPhone}" Fill="#94A3B8" Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                        <TextBlock Text="{Binding CurrentUser.PhoneNumber}" VerticalAlignment="Center" Foreground="#475569"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource IconWork}" Fill="#94A3B8" Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                        <TextBlock Text="{Binding CurrentUser.Department.DepartmentName}" VerticalAlignment="Center" Foreground="#475569" TextWrapping="Wrap"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Column="1" Background="White" CornerRadius="15">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" Opacity="0.05" ShadowDepth="5" Color="#000"/>
            </Border.Effect>
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="40">
                <StackPanel>
                    <Grid Margin="0,0,0,30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock Text="Thông Tin Chi Tiết" FontSize="20" FontWeight="Bold" Foreground="#1E293B"/>
                            <TextBlock Text="Quản lý thông tin cá nhân và công việc của bạn" FontSize="13" Foreground="#94A3B8" Margin="0,5,0,0"/>
                        </StackPanel>
                        <Button Grid.Column="1" Command="{Binding ToggleEditCommand}" 
                                Background="{Binding IsEditing, Converter={StaticResource BoolToText}, ConverterParameter='#10B981|#1E3A8A'}" 
                                Foreground="White" BorderThickness="0" Height="36" Padding="20,0" Cursor="Hand">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="6"/>
                                </Style>
                            </Button.Resources>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding IsEditing, Converter={StaticResource BoolToText}, ConverterParameter='LƯU THAY ĐỔI|CHỈNH SỬA'}" FontWeight="Bold" FontSize="12"/>
                            </StackPanel>
                        </Button>
                    </Grid>

                    <TextBlock Text="THÔNG TIN CÁ NHÂN" FontSize="13" FontWeight="Bold" Foreground="#64748B" Margin="0,0,0,15"/>
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Họ và Tên" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.FullName, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2"></StackPanel>
                    </Grid>

                    <TextBlock Text="LIÊN HỆ &amp; ĐỊA CHỈ" FontSize="13" FontWeight="Bold" Foreground="#64748B" Margin="0,10,0,15"/>
                    <Grid Margin="0,0,0,20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Email" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.Email, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}"/>
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Số Điện Thoại" Style="{StaticResource LabelStyle}"/>
                            <TextBox Text="{Binding CurrentUser.PhoneNumber, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}"/>
                        </StackPanel>
                    </Grid>

                    <StackPanel Margin="0,0,0,30">
                        <TextBlock Text="Địa Chỉ Thường Trú" Style="{StaticResource LabelStyle}"/>
                        <TextBox Text="{Binding CurrentUser.Address, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="{Binding IsEditing, Converter={StaticResource InverseBool}}" Height="60" TextWrapping="Wrap" VerticalContentAlignment="Top" VerticalScrollBarVisibility="Auto"/>
                    </StackPanel>

                    <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="8" Padding="20">
                        <StackPanel>
                            <TextBlock Text="THÔNG TIN CÔNG VIỆC" FontSize="13" FontWeight="Bold" Foreground="#64748B" Margin="0,0,0,15"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Mã Nhân Viên" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding CurrentUser.EmployeeID}" IsReadOnly="True" FontWeight="Bold"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Phòng Ban" Style="{StaticResource LabelStyle}"/>
                                    <TextBox Text="{Binding CurrentUser.Department.DepartmentName}" IsReadOnly="True" FontWeight="Bold"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>